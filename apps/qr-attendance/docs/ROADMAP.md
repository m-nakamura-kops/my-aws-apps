# QRコード打刻システム 実装ロードマップ

## フェーズ1: 基盤構築（Step 1 - 完了）

### ✅ 完了項目
- [x] データベーススキーマ定義（SQL DDL）
- [x] プロジェクト構造の作成
- [x] ドキュメント整備

### 📋 現在のタスク
- [ ] フロントエンド初期セットアップ
- [ ] バックエンド初期セットアップ
- [ ] AWSインフラ構築（CDK/CloudFormation）

---

## フェーズ2: 認証・ユーザー管理（Step 2）

### 目標
- Amazon Cognito統合
- ユーザー登録・ログイン機能
- セッション管理

### 実装項目

#### フロントエンド
- [ ] ログイン画面コンポーネント
- [ ] ユーザー登録フォーム
- [ ] Cognito認証フロー実装
- [ ] 認証状態管理（Context/Redux）

#### バックエンド
- [ ] `/v1/users/login` (POST) - ログイン
- [ ] `/v1/users/register` (POST) - ユーザー登録
- [ ] Cognito統合Lambda関数

#### インフラ
- [ ] Cognito User Pool作成
- [ ] Cognito Identity Pool作成（オプション）
- [ ] IAMロール設定

**推定期間**: 1-2週間

---

## フェーズ3: イベント管理機能（Step 3）

### 目標
- イベント作成・編集・削除
- イベント一覧表示
- カレンダー表示

### 実装項目

#### フロントエンド
- [ ] イベント一覧画面（テーブル形式）
- [ ] イベント作成モーダル
- [ ] イベント編集モーダル
- [ ] カレンダー表示コンポーネント
- [ ] QRコード生成・表示機能

#### バックエンド
- [ ] `/v1/admin/events` (POST) - イベント作成
- [ ] `/v1/admin/events` (GET) - イベント一覧取得
- [ ] `/v1/admin/events/{eventId}` (PUT) - イベント更新
- [ ] `/v1/admin/events/{eventId}` (DELETE) - イベント削除
- [ ] `/v1/admin/events/{eventId}/qr` (GET) - QRコード生成

#### データベース
- [ ] イベントCRUD操作
- [ ] バリデーション実装

**推定期間**: 1-2週間

---

## フェーズ4: 参加申込機能（Step 4）

### 目標
- イベントへの参加申込
- 申込状況確認

### 実装項目

#### フロントエンド
- [ ] イベント詳細画面
- [ ] 参加申込ボタン
- [ ] 申込状況表示

#### バックエンド
- [ ] `/v1/users/events/{eventId}/register` (POST) - 参加申込
- [ ] `/v1/users/events/{eventId}/register` (DELETE) - 申込取消
- [ ] `/v1/users/registrations` (GET) - 申込一覧取得

#### データベース
- [ ] registrationsテーブル操作
- [ ] 重複申込防止ロジック

**推定期間**: 1週間

---

## フェーズ5: QRコード打刻機能（Step 5）

### 目標
- QRコードスキャン機能
- 入退室打刻
- 打刻履歴記録

### 実装項目

#### フロントエンド
- [ ] QRコードスキャン画面
- [ ] カメラアクセス（getUserMedia API）
- [ ] QRコード読み取りライブラリ統合
- [ ] 打刻確認モーダル
- [ ] 打刻履歴表示

#### バックエンド
- [ ] `/v1/attendance/punch` (POST) - 打刻処理
  - リクエスト: `{ qr_code_data, email, event_id }`
  - レスポンス: `{ log_id, in_time, out_time }`
- [ ] `/v1/attendance/history` (GET) - 打刻履歴取得
- [ ] QRコード検証ロジック
- [ ] 入退室判定ロジック（既存の打刻があるかチェック）

#### データベース
- [ ] attendance_logsテーブル操作
- [ ] staff_email必須チェック
- [ ] トランザクション処理

**推定期間**: 2週間

---

## フェーズ6: 管理者機能（Step 6）

### 目標
- 生徒名簿管理
- スタッフ管理
- レポート出力
- お知らせ管理

### 実装項目

#### フロントエンド
- [ ] 生徒管理一覧画面
- [ ] スタッフ管理画面
- [ ] 出席レポート画面（グラフ表示）
- [ ] お知らせ作成・編集画面
- [ ] CSVアップロード機能

#### バックエンド
- [ ] `/v1/admin/students` (GET) - 生徒名簿取得
- [ ] `/v1/admin/staffs` (GET) - スタッフ一覧取得
- [ ] `/v1/admin/invite` (POST) - スタッフ招待
- [ ] `/v1/admin/reports` (GET) - レポート出力
- [ ] `/v1/admin/news` (POST) - お知らせ投稿
- [ ] CSVインポート処理

**推定期間**: 2-3週間

---

## フェーズ7: 利用者マイページ（Step 7）

### 目標
- マイページ表示
- QRコード表示・更新
- 参加履歴表示
- スケジュール表示

### 実装項目

#### フロントエンド
- [ ] マイページ画面
- [ ] QRコード表示コンポーネント
- [ ] 参加履歴画面（テーブル形式）
- [ ] スケジュール画面（カレンダー形式）
- [ ] QRコード更新機能

#### バックエンド
- [ ] `/v1/users/me` (GET) - マイページ情報取得
- [ ] `/v1/users/history` (GET) - 参加履歴取得
- [ ] `/v1/users/schedule` (GET) - スケジュール取得
- [ ] QRコード生成API（ユーザー用）

**推定期間**: 1-2週間

---

## フェーズ8: インフラ構築・デプロイ（Step 8）

### 目標
- AWS環境の完全構築
- CI/CDパイプライン構築
- 本番環境デプロイ

### 実装項目

#### Infrastructure as Code
- [ ] AWS CDKプロジェクト作成
- [ ] RDSインスタンス作成
- [ ] Lambda関数デプロイ設定
- [ ] API Gateway設定
- [ ] Amplify Hosting設定
- [ ] Cognito設定
- [ ] VPC設定（必要に応じて）
- [ ] セキュリティグループ設定

#### CI/CD
- [ ] GitHub Actions設定
- [ ] 自動テスト実行
- [ ] 自動デプロイパイプライン
- [ ] 環境変数管理

#### 監視・ログ
- [ ] CloudWatch Logs設定
- [ ] CloudWatch Metrics設定
- [ ] エラー通知設定

**推定期間**: 2-3週間

---

## フェーズ9: テスト・品質保証（Step 9）

### 目標
- 全機能のテスト
- パフォーマンステスト
- セキュリティテスト

### 実装項目

#### テスト
- [ ] 単体テスト（Jest）
- [ ] 統合テスト
- [ ] E2Eテスト（Playwright/Cypress）
- [ ] APIテスト（Postman/Newman）

#### 品質保証
- [ ] コードレビュー
- [ ] セキュリティスキャン
- [ ] パフォーマンス最適化
- [ ] アクセシビリティチェック

**推定期間**: 1-2週間

---

## フェーズ10: ドキュメント・運用準備（Step 10）

### 目標
- 運用マニュアル作成
- ユーザーマニュアル作成
- 運用体制構築

### 実装項目

#### ドキュメント
- [ ] API仕様書（OpenAPI/Swagger）
- [ ] 運用マニュアル
- [ ] ユーザーマニュアル
- [ ] トラブルシューティングガイド

#### 運用
- [ ] バックアップ戦略
- [ ] 災害復旧計画
- [ ] 監視アラート設定
- [ ] サポート体制

**推定期間**: 1週間

---

## 全体スケジュール

| フェーズ | 期間 | 累計 |
|---------|------|------|
| フェーズ1: 基盤構築 | 1週間 | 1週間 |
| フェーズ2: 認証・ユーザー管理 | 1-2週間 | 2-3週間 |
| フェーズ3: イベント管理 | 1-2週間 | 3-5週間 |
| フェーズ4: 参加申込 | 1週間 | 4-6週間 |
| フェーズ5: QRコード打刻 | 2週間 | 6-8週間 |
| フェーズ6: 管理者機能 | 2-3週間 | 8-11週間 |
| フェーズ7: 利用者マイページ | 1-2週間 | 9-13週間 |
| フェーズ8: インフラ構築 | 2-3週間 | 11-16週間 |
| フェーズ9: テスト・QA | 1-2週間 | 12-18週間 |
| フェーズ10: ドキュメント | 1週間 | 13-19週間 |

**総推定期間**: 約3-5ヶ月（フルタイム開発の場合）

---

## 技術スタック

### フロントエンド
- **Next.js 14+**: Reactフレームワーク
- **TypeScript**: 型安全性
- **Tailwind CSS**: スタイリング
- **AWS Amplify UI**: UIコンポーネントライブラリ
- **QR Code Library**: QRコード生成・読み取り

### バックエンド
- **AWS Lambda**: サーバーレス関数
- **Node.js 18+**: ランタイム
- **TypeScript**: 型安全性
- **AWS SDK**: AWSサービス連携

### データベース
- **Amazon RDS (MySQL/MariaDB)**: リレーショナルデータベース
- **Prisma/TypeORM**: ORM（オプション）

### インフラ
- **AWS CDK**: Infrastructure as Code
- **AWS Amplify**: フロントエンドホスティング
- **Amazon Cognito**: 認証・認可
- **API Gateway**: REST API
- **CloudWatch**: 監視・ログ

---

## 次のステップ

1. **フェーズ2の開始**: 認証機能の実装に着手
2. **開発環境の整備**: ローカル開発環境の構築
3. **チーム体制**: 必要に応じて開発メンバーの確保

---

## 注意事項

- 各フェーズは独立して開発可能ですが、依存関係に注意してください
- セキュリティは常に最優先事項として扱ってください
- データベースのバックアップは定期的に実施してください
- 本番環境へのデプロイ前に必ずステージング環境でテストしてください
