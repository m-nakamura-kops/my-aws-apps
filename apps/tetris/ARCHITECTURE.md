# テトリスアプリ システム構成図

## システムアーキテクチャ

### 全体構成図

```
┌─────────────────────────────────────────────────────────────┐
│                        ユーザー                              │
│                    (スマホ/PCブラウザ)                        │
└───────────────────────┬───────────────────────────────────────┘
                        │ HTTPS
                        │
        ┌───────────────▼────────────────┐
        │     AWS Amplify Hosting        │
        │  (Next.js SSR + Static Assets) │
        │                                │
        │  URL: *.amplifyapp.com         │
        └───────────────┬────────────────┘
                        │
        ┌───────────────▼────────────────┐
        │      GitHub Repository         │
        │  (m-nakamura-kops/my-aws-apps)  │
        │                                │
        │  - ソースコード管理             │
        │  - 自動デプロイトリガー         │
        └────────────────────────────────┘
```

### 詳細構成図

```
┌──────────────────────────────────────────────────────────────┐
│                      クライアント側                           │
│  ┌────────────────────────────────────────────────────────┐ │
│  │             ブラウザ (Chrome/Safari等)                 │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │         Next.js アプリケーション                  │  │ │
│  │  │  ┌────────────────────────────────────────────┐│  │ │
│  │  │  │  React Components (Tetris.tsx)               ││  │ │
│  │  │  │  - ゲームロジック                            ││  │ │
│  │  │  │  - UI/UX                                     ││  │ │
│  │  │  └────────────────────────────────────────────┘│  │ │
│  │  │  ┌────────────────────────────────────────────┐│  │ │
│  │  │  │  LocalStorage API                          ││  │ │
│  │  │  │  - ハイスコア保存                          ││  │ │
│  │  │  └────────────────────────────────────────────┘│  │ │
│  │  │  ┌────────────────────────────────────────────┐│  │ │
│  │  │  │  PWA機能                                    ││  │ │
│  │  │  │  - manifest.json                           ││  │ │
│  │  │  │  - Service Worker (将来実装)                ││  │ │
│  │  │  └────────────────────────────────────────────┘│  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────┘
                        │
                        │ HTTPS
                        │
┌───────────────────────▼───────────────────────────────────────┐
│                     サーバー側                                │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              AWS Amplify Hosting                       │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │  Build Pipeline                                  │  │ │
│  │  │  - amplify.yml設定                               │  │ │
│  │  │  - npm ci (依存関係インストール)                   │  │ │
│  │  │  - npm run build (Next.jsビルド)                  │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │  Next.js Runtime                                 │  │ │
│  │  │  - SSR (Server-Side Rendering)                   │  │ │
│  │  │  - Static Assets配信                             │  │ │
│  │  │  - API Routes (将来実装)                         │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                               │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              GitHub (ソースコード管理)                 │ │
│  │  - コードリポジトリ                                    │ │
│  │  - 自動デプロイトリガー                                 │ │
│  └────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

### データフロー図

```
┌─────────────┐
│   ユーザー   │
└──────┬──────┘
       │
       │ 1. アクセス
       │
┌──────▼──────────────────────────────────────────┐
│         AWS Amplify Hosting                     │
│  ┌──────────────────────────────────────────┐  │
│  │  Next.js アプリケーション                  │  │
│  │  ┌──────────────────────────────────────┐ │  │
│  │  │  Initial Load                        │ │  │
│  │  │  - HTML/CSS/JS配信                   │ │  │
│  │  └──────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────┘  │
└──────┬──────────────────────────────────────────┘
       │
       │ 2. アプリケーション実行
       │
┌──────▼──────────────────────────────────────────┐
│        ブラウザ (クライアント側)                 │
│  ┌──────────────────────────────────────────┐  │
│  │  React Components                         │  │
│  │  ┌──────────────────────────────────────┐ │  │
│  │  │  ゲームロジック実行                   │ │  │
│  │  │  - ブロック落下                       │ │  │
│  │  │  - 衝突判定                           │ │  │
│  │  │  - ライン消去                         │ │  │
│  │  │  - スコア計算                         │ │  │
│  │  └──────────────────────────────────────┘ │  │
│  │  ┌──────────────────────────────────────┐ │  │
│  │  │  LocalStorage                        │ │  │
│  │  │  - ハイスコア保存                    │ │  │
│  │  │  - ハイスコア読み込み                │ │  │
│  │  └──────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

### デプロイフロー図

```
┌─────────────────┐
│  開発者          │
│  (ローカル開発)   │
└────────┬─────────┘
         │
         │ 1. コード編集
         │
┌────────▼────────────────────────────────────┐
│  ローカル環境                                 │
│  - npm run dev                               │
│  - 動作確認                                   │
└────────┬────────────────────────────────────┘
         │
         │ 2. git commit & push
         │
┌────────▼────────────────────────────────────┐
│  GitHub Repository                          │
│  - ソースコード保存                          │
│  - Webhook送信                               │
└────────┬────────────────────────────────────┘
         │
         │ 3. Webhook受信
         │
┌────────▼────────────────────────────────────┐
│  AWS Amplify                                 │
│  ┌────────────────────────────────────────┐ │
│  │  Build Phase                           │ │
│  │  1. リポジトリクローン                  │ │
│  │  2. npm ci (依存関係インストール)        │ │
│  │  3. npm run build (Next.jsビルド)       │ │
│  └────────────────────────────────────────┘ │
│  ┌────────────────────────────────────────┐ │
│  │  Deploy Phase                          │ │
│  │  - ビルド成果物をデプロイ                │ │
│  │  - CDN配信                              │ │
│  └────────────────────────────────────────┘ │
└────────┬────────────────────────────────────┘
         │
         │ 4. デプロイ完了
         │
┌────────▼────────────────────────────────────┐
│  本番環境 (Amplify Hosting)                  │
│  - ユーザーがアクセス可能                    │
│  - 自動スケーリング                          │
└─────────────────────────────────────────────┘
```

## 技術スタック

### フロントエンド
- **Next.js 16.1.4**: Reactフレームワーク
- **React 19.2.3**: UIライブラリ
- **TypeScript**: 型安全性
- **Tailwind CSS 4**: スタイリング
- **PWA**: プログレッシブウェブアプリ

### ホスティング
- **AWS Amplify Hosting**: サーバーレスホスティング
  - SSR (Server-Side Rendering)
  - CDN配信
  - 自動スケーリング

### ソースコード管理
- **GitHub**: バージョン管理
- **Git**: 分散バージョン管理システム

### ストレージ（現在）
- **LocalStorage**: ブラウザ内のハイスコア保存

### 将来の拡張予定
- **AWS DynamoDB**: ハイスコアランキング
- **AWS API Gateway**: APIエンドポイント
- **AWS Lambda**: サーバーレス関数

## ファイル構成

```
apps/tetris/
├── src/
│   ├── app/
│   │   ├── layout.tsx          # メタデータ、PWA設定
│   │   ├── page.tsx            # メインページ
│   │   ├── globals.css         # グローバルスタイル
│   │   └── api/
│   │       └── score/
│   │           └── route.ts   # APIルート（将来実装）
│   └── components/
│       └── Tetris.tsx          # ゲームロジック・UI
├── public/
│   ├── manifest.json           # PWA設定
│   ├── icon-192.png           # PWAアイコン
│   └── icon-512.png           # PWAアイコン
├── amplify.yml                 # Amplifyビルド設定
├── package.json               # 依存関係
└── tsconfig.json              # TypeScript設定
```

## セキュリティ

### 現在の実装
- HTTPS通信（Amplifyが自動提供）
- クライアント側のみの処理（サーバーサイドの脆弱性なし）

### 将来の実装
- API認証（AWS Cognito）
- スコア検証（不正防止）
- Rate Limiting（API Gateway）

## パフォーマンス

### 最適化
- Next.js SSRによる高速初期ロード
- CDN配信による低レイテンシ
- クライアント側のゲームロジック（サーバー負荷なし）
- LocalStorageによる高速データアクセス

### メトリクス
- 初期ロード時間: < 2秒
- ゲームフレームレート: 60fps
- メモリ使用量: < 50MB

## スケーラビリティ

### 現在
- Amplifyの自動スケーリング
- CDNによるグローバル配信
- クライアント側処理（サーバー負荷なし）

### 将来
- DynamoDBによるスケーラブルなデータストレージ
- Lambdaによるサーバーレス処理
- API Gatewayによる高可用性

## 監視・ログ

### 現在
- Amplifyコンソールでのビルドログ確認
- ブラウザの開発者ツール

### 将来
- CloudWatch Logs（Amplify統合）
- CloudWatch Metrics
- エラートラッキング（Sentry等）

## 参考資料

- [Next.js Documentation](https://nextjs.org/docs)
- [AWS Amplify Documentation](https://docs.aws.amazon.com/amplify/)
- [React Documentation](https://react.dev/)
- [PWA Documentation](https://web.dev/progressive-web-apps/)
